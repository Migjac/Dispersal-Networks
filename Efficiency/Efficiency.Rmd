---
title: "Frugivore efficiency network analysis"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

####**Step 1. **Open Martinazo and Matasgordas efficiency matrix

Opening a matrix file with weighted links with frugivores fruit remotion efficiency in individual plants. The data set to construct this matrix was the resul of dividing *fruits/day and visits/day= fruits/visit*


```{r}
#Martinazo
mart_e<-read.csv("~/Desktop/Palmito/Postdoc-Interaction Networks/Dispersal-Networks/Efficiency/mart_eff.csv",header=TRUE,check.names=FALSE,row.names=1)

#Matasgordas
matas_e<-read.csv("~/Desktop/Palmito/Postdoc-Interaction Networks/Dispersal-Networks/Efficiency/matas_eff.csv",header=TRUE,check.names=FALSE,row.names=1)
```

&nbsp;

####**Step 2.** Using "bipartite" package
&nbsp;

```
library(bipartite)
```
&nbsp;

```{r, message=F, cache=F, echo=F, include = FALSE}
library(bipartite)
```
&nbsp;
&nbsp;

#####*Step 2.1.* Ploting the web.
Creates a bipartite network were the high level will be represented by the frugivores and low level to each individual plant. *Links are weigthed with the frugivory efficiency fruit animal/individual plant/visits per day*.[^2] 

[^2]: <span style="color:gray">For more information see previous analysis

```{r,echo=FALSE}
#Martinazo Bipartite network
par(mfrow = c(2,1))
plotweb(mart_e, col.low=c(gray(seq(0.1,1,length=22))), col.high=c("white","white","gray30","gray30","black","darkgray"),method="normal", text.rot=90,low.lablength=10, high.lablength=8)

#Matasgordas Bipartite Network
plotweb(matas_e, col.low=c(gray(seq(0.1,1,length=34))), col.high=c("white","white","gray30","gray30","black","black","darkgray"), method="normal", text.rot=90,low.lablength=10, high.lablength=8)
```

&nbsp;
&nbsp;

####**Step 3.** Calculate indices describing network topography. 

#####**Step 4.1.** Network measures
&nbsp;

* **Network level** Analysis of bipartite webs at the level of the entire network

+ *Connectance:* Degree of specialization of the netwwork, meaure the proportion of possible links. C = L/(IJ). This is the standardized number of species combinations often used in co-occurrence analyses (Gotelli and Graves 1996); also identical to 2-species motifs sensu Milo et al. (2002).

+ *Cluster coefficient:* Mean, across all species, of the number of realized links divided by the number of possible links for each species (i.e. average per-species connectance).

+ *Web Assymethry:* Balance between numbers in the two levels W = (I– J)/(I+J). Positive numbers indicate more lower-trophic level species, negative more higher-trophic level species; rescaled to [–1, 1] (see Blüthgen et al. 2007).

+ *Nestednes and Wegihted Nestedness:* Interaction degree between specialists and the subset of species to which the generalists interact 

&nbsp;

```{r Networklevel of Martinazo}
#Martinazo
networklevel(mart_e, index = c("connectance","web asymmetry","cluster coefficient","nestedness","weighted nestedness"))
```

```{r Networklevel of Matasgordas}
#Matasgordas
networklevel(matas_e,index = c("connectance","web asymmetry","cluster coefficient","nestedness","weighted nestedness"))
```

```{r Modularity, message=F, cache=T, echo=F, include = FALSE}
mod_mart_e<-computeModules(mart_e)
mod_matas_e<-computeModules(matas_e)
```
&nbsp;

+ *Modularity:* Identify modules of closely interecting frugivores. Also test to what extent these modules have a spatial component. High modularity values means that the network is more stable.

Martinazo
```{r Modularity value of Martinazo, echo=FALSE}
mod_mart_e@likelihood
```
Matasgordas
```{r Modularity value of Matasgordas}
mod_matas_e@likelihood
```
Modularity in Matasgordas (0.569946) than Martinazo (0.500577)

&nbsp;
&nbsp;

#####Ploting modules in the networks

```{r plots of the visit modules, echo=FALSE}
par(mfrow=c(1,2))
plotModuleWeb(mod_mart_e)
plotModuleWeb(mod_matas_e)
```
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;

Figure 3. 

&nbsp;




&nbsp
* **Link level.** Interaction variance between nodes. The outcome is a matrix with dependence values. Computes the contribution of each species to the overall nestedness.

```{r link level of each population}
link_lev_mart<-linklevel(mart_e)
link_lev_matas<-linklevel(matas_e)
```

&nbsp;
&nbsp;


&nbsp;

#####**Step 5.**Calculate the topography of the nodes and their relative importance to the network. Information that we can relate to the aggregation level of this plants through GLM or GAM.

There are three different levels this can be achieved at: the entire web (using function networklevel), at the level of each group (also using function networklevel) or the individual species (using function specieslevel). 

* **Relative degree.** It is a centrality measure. Proportion of interactions in relation to the potential partners in the network. Importance with the number of plants or animals with which they interact. High values in individual plants in our system is related to "more attractiveness". (qualitative characteristic of the node) interact or not

* **Species strength.** (Dorman, 2011). Describe how much the plants depends on the visits by a particular animal. Importance of the **plant** given by the porportion of visits of each animal. Instead, the values for **animals** tell us the importance of each animal given the proportion of visits that they made. 

* **Species Specificity.** Coefficient of variation of interactions, normalised to values between 0 and 1. Values of 0 indicate low, those of 1 a high variability (and hence suggesting low and high specificity). We can determine if certain **plants** have high visitation and fruit removal by animals or low. Instead, for **animals** we can determine if they have a high efficiency or low. (quantitative index). The difference in this index is that uses the "visitation values "efficiency" of each interaction.

* **Node specialisation index.** Another measure of specialisation, based on the path length between any two higher-trophic level species. For instance, species sharing hosts/prey have an FS-value of 1. It is a purely qualitative measure. Smaller the values, the more directly type A species are linked with type B species in network, and the less strict is the functional specialization.level of interdependence between plant and frugivore species.

* **Effective partners.** The effective number of partners, if each partner was equally common. In our study is only useful for plants.

&nbsp;
```
spp_lev_mart<-specieslevel(mart_e)
spp_lev_mart<-specieslevel(matas_e)
```
&nbsp;
&nbsp;

####Martinazo
```{r Martinazo visits node characteristics}
HLspplvlmart<-specieslevel(mart_e)
HLspplvlmart$`higher level`[,c(2,3,8,10)]
LLspplvlmart<-specieslevel(mart_e)
LLspplvlmart$`lower level`[,c(2,3,7,10,17)]
```
&nbsp;

####Matasgordas
```{r Matasgordas visits node characteristics, echo=FALSE}
spplvlmatas<-specieslevel(matas_e)
spplvlmatas$`higher level`[,c(2,3,8,10)]
LLspplvlmatas<-specieslevel(matas_e)
LLspplvlmatas$`lower level`[,c(2,3,7,10,17)]
```

&nbsp;
####**Step 6.** Gathering Martinazo and Matasgordas' matrixs as one; plants are ordered from more to less aggregated

```{r Network of both populations,echo=F}
par(mfrow=c(1,1))
mart_matas_e<-read.csv("~/Desktop/Palmito/Postdoc-Interaction Networks/Dispersal-Networks/Efficiency/mart_matas_eff.csv",header=TRUE,check.names=FALSE,row.names=1)
plotweb(mart_matas_e, col.low=c(gray(seq(0.1,1,length=63))),col.high=c("white","white","gray30","gray30","black","black","darkgray"),method="normal", text.rot=90,low.lablength=10, high.lablength=8)
```
&nbsp;
&nbsp;
&nbsp;



####**Step 6.1** Calculate indices describing network topography of the general network. 

#####**Step 6.1.1** Network measures

* **Network level** Analysis of bipartite webs at the level of the entire network

+ *Connectance* 

+ *Cluster coefficient* 

+ *Web Assymethry*

+ *Nestednes and Wegihted Nestedness:*

&nbsp;
&nbsp;

```{r Networklevel of both populations}
networklevel(mart_matas_e, index = c("connectance","web asymmetry","cluster coefficient","nestedness","weighted nestedness"))
```

+ *Modularity* 

```{r Modularity in both populations, message=F, cache=T, echo=F, include = FALSE}
mod_mart_matas_e<-computeModules(mart_matas_e)
```


Matasgordas y Martinazo
```{r Modularity value of both populations, echo=FALSE}
mod_mart_matas_e@likelihood
```

#####Ploting modules in the networks

```{r plots of the modules of both populations in one, echo=FALSE}
par(mfrow=c(1,1))
plotModuleWeb(mod_mart_matas_e)
```
&nbsp;
&nbsp;
&nbsp;
&nbsp;
&nbsp;

Figure 3.

&nbsp;

It doesn't make many sense unless the plants have similar characteritics.  Perhaps, the plants are the aggregated ones, however, the results can change due to iteration process.



&nbsp
* **Link level.** Interaction variance between nodes. The outcome is a matrix with dependence values. Computes the contribution of each species to the overall nestedness.

```{r link level value of both populations}
linklevel(mart_matas_e)
```

&nbsp;
&nbsp;
&nbsp;

#####**Step 6.1.2.**Calculate the topography of the nodes and their relative importance to the network. 

* **Relative degree.** 

* **Species strength.**  

* **Species Specificity.** 

* **Node specialisation index.** 

* **Effective partners.** 

&nbsp;
```
spp_lev_mart<-specieslevel(mart_matas_e)
```

```{r Martinazo and Matasgordas visits node characteristics}
HLspplvlmart<-specieslevel(mart_matas_e)
HLspplvlmart$`higher level`[,c(2,3,8,10)]
LLspplvlmart<-specieslevel(mart_matas_e)
LLspplvlmart$`lower level`[,c(2,3,7,10,17)]
```

&nbsp;
&nbsp;
&nbsp;

